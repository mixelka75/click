# Скрипты для управления Telegram каналами

## Быстрая настройка тестовых каналов

### setup_test_channels.sh

Автоматически заменяет все каналы в `.env` на ваш тестовый канал.

**Использование:**

```bash
# С указанием канала:
./scripts/setup_test_channels.sh @my_test_channel

# Или интерактивно (скрипт спросит канал):
./scripts/setup_test_channels.sh
```

**Что делает:**
- Создает бэкап текущего `.env`
- Заменяет все каналы (вакансии + резюме) на указанный
- Показывает инструкции по дальнейшим действиям

**Пример:**
```bash
./scripts/setup_test_channels.sh @click_test_123

# Вывод:
# === CLICK - Настройка тестовых каналов ===
#
# Настраиваю канал: @click_test_123
# ✓ Создан бэкап: .env.backup.20250104_143022
# ✓ Каналы вакансий настроены
# ✓ Каналы резюме настроены
#
# === Настройка завершена! ===
```

## Восстановление продакшн каналов

### restore_prod_channels.sh

Восстанавливает все каналы обратно на продакшн значения.

**Использование:**

```bash
./scripts/restore_prod_channels.sh
```

**Что делает:**
- Создает бэкап текущего `.env`
- Восстанавливает все продакшн каналы:
  - @horeca_msk1 (Бармены)
  - @horeca_msk2 (Официанты)
  - @horeca_povara1 (Повара)
  - @horeca_barista (Баристы)
  - @horeca_admin_man (Управление)
  - @horeca5 (Вспомогательный персонал)
  - @horeca4 (Прочие)
  - @HoReCaMBA (Общий)
- Показывает список восстановленных каналов

## Бэкапы

Оба скрипта автоматически создают бэкап `.env` файла перед изменениями:

```bash
# Формат бэкапа:
.env.backup.YYYYMMDD_HHMMSS

# Например:
.env.backup.20250104_143022

# Восстановить из бэкапа:
cp .env.backup.20250104_143022 .env
```

## Требования

- Linux/macOS или WSL на Windows
- Bash
- sed

## Типичный workflow для тестирования

```bash
# 1. Создайте тестовый канал в Telegram
# 2. Добавьте бота как администратора

# 3. Настройте тестовый канал
./scripts/setup_test_channels.sh @my_test_channel

# 4. Перезапустите приложение
docker-compose restart

# 5. Тестируйте публикации

# 6. Когда закончили - восстановите продакшн
./scripts/restore_prod_channels.sh

# 7. Перезапустите приложение
docker-compose restart
```

## Ручная настройка (без скриптов)

Если скрипты не работают, можно настроить вручную:

1. Откройте `.env` в текстовом редакторе
2. Найдите все строки начинающиеся с `CHANNEL_`
3. Замените значения на ваш тестовый канал
4. Сохраните файл
5. Перезапустите приложение

## Проверка текущих каналов

```bash
# Посмотреть все настроенные каналы:
grep "^CHANNEL_" .env

# Посмотреть только каналы вакансий:
grep "^CHANNEL_VACANCIES" .env

# Посмотреть только каналы резюме:
grep "^CHANNEL_RESUMES" .env
```

## Troubleshooting

### Скрипт не запускается

```bash
# Убедитесь что скрипт исполняемый:
chmod +x scripts/setup_test_channels.sh
chmod +x scripts/restore_prod_channels.sh

# Запустите с явным указанием bash:
bash scripts/setup_test_channels.sh @my_test_channel
```

### sed: command not found (Windows Git Bash)

Используйте WSL или настройте вручную через текстовый редактор.

### Публикация все равно не работает

Проверьте:
1. Бот добавлен в канал?
2. У бота права администратора?
3. У бота права на публикацию сообщений?
4. Приложение перезапущено после изменения .env?
5. Логи: `docker-compose logs backend | grep publish`

## См. также

- [TESTING.md](../docs/TESTING.md) - подробная инструкция по тестированию
- [CHANNELS_QUICK_SETUP.md](../docs/CHANNELS_QUICK_SETUP.md) - быстрая шпаргалка
- [SETUP.md](../docs/SETUP.md) - полная документация проекта
